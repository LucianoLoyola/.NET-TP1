@page "/nuevoExpediente/{id}"
@using SGE.Aplicacion
InteractiveServer
@inject CasoDeUsoExpedienteAlta CasoDeUsoExpedienteAlta
@inject NavigationManager Navegador

<h3>Agregar Expediente</h3>

@* Formulario para agregar Poliza *@
<form>
    <div class="form-group">
        <label for="valorAsegurado">Caratula:</label>
        <input type="text" class="form-control" id="caratula" @bind="expediente.caratula" required>
    </div>

    @* Campo para seleccionar el estado del expediente *@
    <div class="form-group">
        <label for="estado">Estado del Expediente:</label>
        <select id="estado" class="form-control" @bind="expediente.estado">
            @foreach (var estado in estados)
            {
                <option value="@estado">@estado</option>
            }
        </select>
    </div>

    @* Generar botones para seleccionar el tipo de cobertura *@
    <div class="form-group">
        <label>Tipo de Cobertura:</label>
        <div>
            <input type="radio" name="Cobertura" id="todoriesgo"
            @onchange="(() => UpdateCobertura(Poliza.TipoCobertura.TodoRiesgo))" />
            <label for="todoriesgo">Cobertura contra todo riesgo</label>
        </div>
        <div>
            <input type="radio" name="Cobertura" id="civil"
            @onchange="(() => UpdateCobertura(Poliza.TipoCobertura.ResponsabilidadCivil))" />
            <label for="civil">Cobertura de responsabilidad civil</label>
        </div>
    </div>


    <button type="button" class="btn btn-primary" @onclick="CrearPoliza">Crear</button>

</form>

@* Componente para mostrar errores *@
<Excepcion @ref=dialogo />


@code {
    [Parameter]
    public string? Id { get; set; }
    @* Excepcion dialogo = null!; *@
    Expediente expediente = new Expediente();

    protected override void OnInitialized()
    {
        if (Id != null) expediente.Id = int.Parse(Id);

    }

    private void UpdateCobertura(Estado value)
    {
        expediente.estado = value;
    }

    private void CrearPoliza()
    {
        try
        {
            agregarPoliza.Ejecutar(poliza);
            Siguiente();
        }
        catch (Exception e)
        {
            dialogo.Mostrar(e.Message);
        }
    }
    // El vehiculo se creo con exito y ahora se le agrega la poliza
    private void Siguiente()
    {
        NavigationManager.NavigateTo("/");
    }
}    using SGE.Aplicacion;
